% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/vol_nl.R
\name{vol_nl}
\alias{vol_nl}
\title{Estimate tree volume for Newfoundland}
\usage{
vol_nl(DBH, height, species, subregion = "Province", keep_net = FALSE)
}
\arguments{
\item{DBH}{Numeric vector. Diameter at breast height (cm).}

\item{height}{Numeric vector. Total tree height (m).}

\item{species}{Character vector of NFI species codes (e.g., `"PICE.MAR"`).}

\item{subregion}{Character or numeric vector. Either:
- `"Province"` (default; uses province-wide equations), or
- District IDs `1-24`.
Only District `2` and `4-18` use district-level equations;
all others fall back to province-wide equations.}

\item{keep_net}{Logical. If `TRUE`, additional columns
`vol_merchantable_gross` and `vol_merchantable_net`
are returned.}
}
\value{
A tibble with:
  - `vol_total`: Total stem volume inside bark (m³).
  - `vol_merchantable`: Gross merchantable volume inside bark (m³).

  If `keep_net = TRUE`, also returns:
  - `vol_merchantable_gross`
  - `vol_merchantable_net`
}
\description{
Implements the Newfoundland individual-tree volume equations used in the
Open Stand Model (OSM) API, based on Honer’s refitted formulations.
}
\details{
Model structure:
- District-level equations (NX-242) are used only for District 2 and 4–18
  and only for balsam fir (`ABIE.BAL`) and black spruce (`PICE.MAR`).
- All other districts (including District 19 and 1–24 outside 2, 4–18)
  fall back to province-wide species equations (NX-122 total + NX-67 merchantable).

The original OSM implementation excluded District 19
because it produced unstable or unrealistic results. This function reproduces
that behavior for consistency.

Net merchantable volume:
- Net merchantable volume equations are available only for NX-242 district models.
- When available, net merchantable volume volume is constrained to be between
  95% and 100% of gross merchantable volume, matching the original OSM implementation
- By default, the function returns gross merchantable volume to remain
  consistent with other volume models in the package.


Merchantable volume is computed between jurisdictional stump height
and top diameter limits obtained from `get_merch_criteria("NL")`.
Trees below the minimum DBH threshold return zero merchantable volume,
but total volume is still computed.
}
\examples{
# Province-wide model (default)
vol_nl(20, 20, "PICE.MAR")

# District-level model (NX-242 used for District 2)
vol_nl(20, 20, "PICE.MAR", subregion = 2)

# Return net merchantable volume (if available)
vol_nl(20, 20, "PICE.MAR", subregion = 2, keep_net = TRUE)

# Tidyverse workflow example
trees <- tibble::tibble(
  DBH = c(15, 20, 25, 30),
  height = c(15, 20, 21, 25),
  species = c("PICE.MAR", "ABIE.BAL","PICE.MAR", "BETU.PAP"),
  subregion = c("Province", 2, 17, "Province")
)

trees |>
  dplyr::mutate(vol = vol_nl(DBH, height, species, subregion)) |>
  tidyr::unnest(vol)

}
\references{
Honer, T.G. (1967). Standard volume tables and merchantable conversion factors.
Canadian Forest Service Information Report N-X-67.

Ker, M.F. 1974. Metric Tree Volume Tables for Newfoundland. Newfoundland Forest Research Centre, St. Johns, NF. Information Report N-X-122. https://ostrnrcan-dostrncan.canada.ca/handle/1845/238893

Warren, G.R. & Meades, J.P. (1986). Wood defect and density studies II:
Total and net volume equations for Newfoundland’s forest management units.
Canadian Forest Service Information Report N-X-242.
}
