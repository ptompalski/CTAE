% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/boudewyn.R
\name{v2b}
\alias{v2b}
\title{Convert volume to aboveground biomass components (Boudewyn et al. 2007)}
\usage{
v2b(
  volume,
  species,
  jurisdiction,
  ecozone,
  include_props = FALSE,
  include_intermediates = FALSE,
  renormalize = TRUE,
  clamp_x = FALSE
)
}
\arguments{
\item{volume}{Numeric vector. Gross merchantable volume per hectare.}

\item{species}{Character vector. NFI species codes (e.g., \code{"PICE.MAR"}).
Genus-level codes (\code{"PICE.SPP"}) and variety-level codes
(\code{"PICE.MAR.AAA"}) are supported.}

\item{jurisdiction}{Character vector. Jurisdiction code (e.g., \code{"AB"}).}

\item{ecozone}{Numeric vector. Ecozone code (1--15).}

\item{include_props}{Logical. If TRUE, include biomass proportions
(\code{p_sw}, \code{p_sb}, \code{p_br}, \code{p_fl}) in the output.}

\item{include_intermediates}{Logical. If TRUE, include intermediate stem-biomass
quantities (\code{b_m}, \code{b_n}, \code{b_nm}, \code{b_s}) and factors
(\code{f_nm}, \code{f_s}, \code{has_sapling}, \code{b_stem_total}).}

\item{renormalize}{Logical. If TRUE (default), renormalize capped proportions
to sum to 1. This can be helpful when multiple components hit bounds.}

\item{clamp_x}{Logical. If TRUE, clamp \code{volume} to the calibration range
\code{[x_min, x_max]} from Table 7 before evaluating the proportion equations.
Disabled by default.}
}
\value{
A tibble with one row per input observation. By default includes:
\describe{
  \item{b_total}{Total aboveground tree biomass (t/ha).}
  \item{b_bark}{Bark biomass (t/ha).}
  \item{b_branches}{Branch biomass (t/ha).}
  \item{b_foliage}{Foliage biomass (t/ha).}
}
Additional columns are included when \code{include_props} and/or
\code{include_intermediates} are TRUE.
}
\description{
High-level wrapper for the Boudewyn et al. (2007) model-based volume-to-biomass
conversion for live trees. Given gross merchantable volume per hectare, the
function:
\enumerate{
  \item converts volume to stem wood biomass components (Tables 3--5; Eqs. 1--3),
  \item computes biomass proportions using the volume-based multinomial-logit
        models (Table 6; Eqs. 4--7),
  \item applies the Table 7 proportion bounds (caps) to prevent unrealistic
        proportions when extrapolating,
  \item returns total aboveground biomass and components (bark, branches, foliage).
}
}
\details{
The function is vectorized over all inputs and is designed to work naturally
inside \code{dplyr::mutate()} (typically followed by \code{tidyr::unnest()}).


Proportion caps (Table 7).
The Table 6 proportion models can yield extreme values when extrapolated beyond
the calibration range. This implementation applies Table 7 bounds (low/high
caps) to each proportion to keep outputs within plausible limits.

Extrapolation vs clamping.
By default (\code{clamp_x = FALSE}), the input \code{volume} is used directly.
If \code{volume} falls outside the calibration range (\code{x_min/x_max}) reported
in Table 7, results are extrapolations, although Table 7 proportion caps are still
applied. Setting \code{clamp_x = TRUE} replaces \code{volume} with
\code{min(max(volume, x_min), x_max)} before computing proportions; this can
materially change results for high-volume stands and may lead to systematic
underestimation where \code{volume > x_max}. For this reason, clamping is disabled
by default.
}
\examples{
# Single case (one stand)
v2b(
  volume = 350,
  species = "PSEU.MEN",
  jurisdiction = "BC",
  ecozone = 13
)

# Include proportions and intermediate quantities used in the calculation
v2b(
  volume = 350,
  species = "PSEU.MEN",
  jurisdiction = "BC",
  ecozone = 13
  include_props = TRUE,
  include_intermediates = TRUE
)

# Tidyverse workflow: compute biomass for multiple stands
# (one row per stand) and bind results as new columns.
library(dplyr)
library(tidyr)

stands <- tibble::tibble(
  stand_id = 1:3,
  volume = c(120, 350, 300),
  species = c("PICE.MAR", "PSEU.MEN", "PINU.BAN"),
  jurisdiction = c("AB", "BC", "ON"),
  ecozone = c(5, 13, 6)
)

stands |>
  mutate(
    v2b = v2b(
      volume = volume,
      species = species,
      jurisdiction = jurisdiction,
      ecozone = ecozone,
      include_props = TRUE
    )
  ) |>
  unnest(v2b)

}
