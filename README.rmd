---
output: 
  github_document:
    toc: false
    fig_width: 7
    fig_height: 5
---
  
  <!-- README.md is generated from README.Rmd. Please edit that file -->
  
```{r, echo = FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(knitr)
library(CTAE)

options(digits = 2)

knitr::opts_chunk$set(
  collapse = TRUE,
  fig.path = "man/figures/",
  fig.width = 7,
  fig.height = 5,
  comment = "#>",
  dev = "png",
  dpi = 300
)
```
  
# CTAE: Canadian tree allometric equations

CTAE is an R package that brings together a collection of published allometric models developed for Canadian forests. The package provides a unified interface to estimate a range of tree- and stand-level attributes, based on models published in the Canadian forestry literature. The focus of CTAE is on standardization: models are implemented as faithfully as possible to their original formulations, with transparent parameter tables, consistent inputs/outputs, and jurisdiction-appropriate assumptions (e.g. merchantability rules).

CTAE currently includes allometric models to:

- Estimate tree-level volume (total and merchantable)
- Estimate aboveground biomass (AGB)
- Convert volume to biomass
- Convert total volume to merchantable volume
- Apply simple growth models to estimate changes in attributes over time



## Included models

### Aboveground biomass
- Canadian national tree aboveground biomass equations (Lambert et al. 2005, Ung et al. 2008).

### Volume (total and merchantable)

#### Regional models 

- Alberta: `vol_huang94()` - Individual tree volume equations for major Alberta tree species (Huang 1994)
- British Columbia: `vol_kozak94()` - Kozak 1994 Taper Equations
- Manitoba: `vol_klos2007()` - Individual tree volume using parameters developed by Klos (2004)
- Ontario: `vol_zakrzewski2013()` - Zakrzewski et al. (2013) taper/volume model for Ontario
- Saskatchewan: `vol_galbella94()` - Individual tree volume using parameters developed by Gal & Bella (1994)
- Central and eastern Canada: `vol_honer83()` - Honer et al. 1983
- Central and eastern Canada: `vol_sharma2021()` - Sharma 2021

#### National models

- Ung et al. 2013  Canadian national taper models: `vol_national_dbh()` and `vol_national_dbh_ht()`

```{r, echo=F}
# registry with list-column `species`
reg <- volume_model_registry_species()

fmt_inputs <- function(requires_ht) {
  if (requires_ht) "DBH + Ht" else "DBH"
}

fmt_geo <- function(scope, province_scope) {
  # province_scope is a character vector (from list-column)
  if (length(province_scope) == 1 && identical(province_scope, "ALL")) {
    return("Canada (national)")
  }
  paste(province_scope, collapse = ", ")
}

fmt_species <- function(species, max = 10) {
  species <- sort(unique(species))
  if (length(species) == 0) return("—")
  if (length(species) <= max) return(paste(species, collapse = ", "))
  paste0(
    paste(species[1:max], collapse = ", "),
    ", … (+", length(species) - max, ")"
  )
}

readme_tbl <- reg %>%
  transmute(
    Model = engine,
    # `Model ID` = model_id,
    Coverage = purrr::map2_chr(scope, province_scope, fmt_geo),
    Subregion = subregion_type,
    Inputs = purrr::map_chr(requires_ht, fmt_inputs),
    # Species = purrr::map_chr(species, fmt_species, max = 10),
    `N species` = n_species,
    Reference=reference
  ) 

knitr::kable(
  readme_tbl,
  format = "pipe",
  align = c("l","l","l","l","l","l","r")
)
```


### Other

- National volume-to-biomass conversions models (Boudewyn et al. 2007)
- National total volume to merchantable volume conversions models (Boudewyn et al. 2007)
- National growth and yield model (H, BA, V) (Ung et al. 2009)


## Installation 

You can install the most recent version of the package by executing the code below:

```{r, eval=FALSE}
devtools::install_github("ptompalski/CTAE")
library(CTAE)
```

## References 

Boudewyn, P.A.; Song, X.; Magnussen, S.; Gillis, M.D. (2007). Model-based, volume-to-biomass conversion for forested and vegetated land in Canada. Natural Resources Canada, Canadian Forest Service, Pacific Forestry Centre, Victoria, BC. Information Report BC-X-411. 112 p.

Gal, J., & Bella, I.E. (1994). New stem taper functions for 12 Saskatchewan timber species. Natural Resources Canada, Canadian Forest Service, Northwest Region, Information Report NOR-X-338. Table 5.

Honer, T.G.; Ker, M.F.; Alemdag, I.S. 1983. Metric timber tables for the commercial tree species of central and eastern Canada. Environ. Can., Can. For. Serv., Maritimes For. Res. Cent., Fredericton, NB. Inf. Rep. M-X-140. https://ostrnrcan-dostrncan.canada.ca/handle/1845/239814

Huang, S. (1994). Ecologically Based Individual Tree Volume Estimation for Major Alberta Tree Species. Report 1 - Individual tree volume estimation procedures for Alberta: Methods of Formulation and Statistical Foundations. Alberta Environmental Protection, Land and Forest Service, Forest Management Division, Edmonton, AB.

Kozak, A. (1988). A variable-exponent taper equation. Canadian Journal of Forest Research, 18, 1363–1368

Kozak, A. (1994). Development of Taper Equations by BEC Zones and Species. Province of British Columbia, Ministry of Forests (report).

Klos, R. J., Wang, G. G., Dang, Q.-L., & East, E. W. (2007). Taper equations for five major commercial tree species in Manitoba, Canada. Western Journal of Applied Forestry, 22(3), 163–170.

Lambert, M. C., Ung, C. H., & Raulier, F. (2005). Canadian national tree aboveground biomass equations. Canadian Journal of Forest Research, 35(8), 1996–2018. https://doi.org/10.1139/x05-112

Sharma, M. (2021). Total and Merchantable Volume Equations for 25 Commercial Tree Species Grown in Canada and the Northeastern United States. Forests, 12, 1270.

Ung, C.H., Bernier, P., & Guo, X.-J. (2008). Canadian national biomass equations: new parameter estimates that include British Columbia data. Canadian Journal of Forest Research, 38(5), 1123–1132. https://doi.org/10.1139/X07-224
 
Ung, C.H., Bernier, P.Y., Guo, X.J., Lambert, M.-C., 2009. A simple growth and yield model for assessing changes in standing volume across Canada’s forests. The Forestry Chronicle 85, 57–64. https://doi.org/10.5558/tfc85057-1

Ung, C.H., Guo, X.J., Fortin, M., 2013. Canadian national taper models. Forestry Chronicle 89, 211–224. https://doi.org/10.5558/tfc2013-040

Zakrzewski, W.T., Penner, M., 2013. A comparison of tree stem taper models for use in Ontario. Ontario Forest Research Institute, Report 176.